Important Functions
-------------------

The *internal* MD5 implementation is located at 0x099A54B2 in
"i86bi-linux-l3-ipbase-12.4.bin" file.

$ md5sum i86bi-linux-l3-ipbase-12.4.bin
3e79a8010a4174dc316a55e6d1886f3c  i86bi-linux-l3-ipbase-12.4.bin

$ md5sum i86bi-linux-l3-adventerprisek9-15.4.1T.bin
2eabae17778316c49cbc80e8e81262f9  i86bi-linux-l3-adventerprisek9-15.4.1T.bin

We can look for the constants used in the MD5 algorithm.

http://openwall.info/wiki/_media/people/solar/software/public-domain-source-code/md5.c

Searching for "0xd76aa478" and "0xe8c7b756" (constants used in MD5) leads us to
0x099A54B2. We compare this function with Solar's md5.c and see that it is
"MD5_body".

This looks like a standard MD5 implementation without any Cisco specific craziness.

NOTE: The external MD5 functionality is used for license checking stuff only.

GDB tracing
-----------

Breakpoint 1, 0x099a54b2 in ?? ()
(gdb) x/64xb $ecx
...

Setup
-----

# echo '127.42.42.42 xml.cisco.com' >> /etc/hosts

$ ./CiscoIOUKeygen.py > iourc  # generate license

$ ./start-1.sh

$ ./start-2.sh

$ ./iousniff -i /tmp/netio1000/  # used for capturing traffic between the routers

Resources
---------

"First Hop Redundancy Protocols Configuration Guide"

Extra
-----

sudo apt-get install libnet-pcap-perl libpcap0.8

sudo apt-get install uml-utilities bridge-utils

...

VRRP setup
----------

$ ./start-1.sh
***************************************************************
IOS On Unix - Cisco Systems confidential, internal use only
Under no circumstances is this software to be provided to any
non Cisco staff or customers.  To do so is likely to result
in disciplinary action. Please refer to the IOU Usage policy at
wwwin-iou.cisco.com for more information.
***************************************************************
Port 0/0 is connected to:
        20:0/0

              Restricted Rights Legend

Use, duplication, or disclosure by the Government is
subject to restrictions as set forth in subparagraph
(c) of the Commercial Computer Software - Restricted
Rights clause at FAR sec. 52.227-19 and subparagraph
(c) (1) (ii) of the Rights in Technical Data and Computer
Software clause at DFARS sec. 252.227-7013.

           cisco Systems, Inc.
           170 West Tasman Drive
           San Jose, California 95134-1706


...

         --- System Configuration Dialog ---

Would you like to enter the initial configuration dialog? [yes/no]: no

Would you like to terminate autoinstall? [yes]:


Press RETURN to get started!
...

Router>enable
Router#configure te
Router#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#interface Ethernet0/0
Router(config-if)#ip address 10.0.0.1 255.255.255.0
Router(config-if)#no shutdown
Router(config-if)#end
Router#co
*Sep 29 18:34:01.583: %SYS-5-CONFIG_I: Configured from console by console
Router#
*Sep 29 18:34:02.331: %LINK-3-UPDOWN: Interface Ethernet0/0, changed state to up
*Sep 29 18:34:03.331: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/0, changed state to up
Router#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#key chain test
Router(config-keychain)#key 1
Router(config-keychain-key)#key-string password12345
Router(config-keychain-key)#end
Router#
*Sep 29 18:34:27.975: %SYS-5-CONFIG_I: Configured from console by console
Router#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#interface Ethernet0/0
Router(config-if)#vrrp 1 authentication md5 key-chain test
Router(config-if)#vrrp 1 ip 10.0.0.10
Router(config-if)#
*Sep 29 18:35:16.691: %VRRP-6-STATECHANGE: Et0/0 Grp 1 state Init -> Backup
Router(config-if)#
*Sep 29 18:35:20.303: %VRRP-6-STATECHANGE: Et0/0 Grp 1 state Backup -> Master
Router(config-if)#

GDB tracing
-----------

Breakpoint 1 at 0x99a54b2

b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
b'70617373776f72643132333435800000000000000000000000000000000000000000000000000000000000000000000000000000000000006800000000000000'
b'21016401fe0100000a00000a000000000000000070617373776f7264313233343580000000000000000000000000000000000000000000000803000000000000'
